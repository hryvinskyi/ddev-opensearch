name: ddev-opensearch

yaml_read_files:
  projectConfig: .ddev/config.yaml

project_files:
  - docker-compose.opensearch.yaml

pre_install_actions:
  - |
    #ddev-nodisplay
    #ddev-description:Removing old Dockerfile
    file="${DDEV_APPROOT}/.ddev/opensearch/Dockerfile"
    if [ -f "${file}" ]; then
      if grep -q '#ddev-generated' "${file}"; then
        rm -f "${file}"
      else
        echo "${file} needs to be removed but has been modified by the user. Please check it and remove it"
        exit 2
      fi
    fi

post_install_actions:
  - |
    #ddev-nodisplay
    #ddev-description:Registering OpenSearch Dashboards hostname
    printf '#ddev-generated\nadditional_hostnames:\n  - {{ .projectConfig.name }}-opensearch\n' > "${DDEV_APPROOT}/.ddev/config.opensearch-dashboards.yaml"

removal_actions:
  - |
    #ddev-nodisplay
    #ddev-description:Removing OpenSearch Dashboards hostname configuration
    rm -f "${DDEV_APPROOT}/.ddev/config.opensearch-dashboards.yaml"

ddev_version_constraint: '>= v1.24.3'
